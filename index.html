<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Gesture Shooter</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg: #ffffff;
            --text: #000000;
            --text-secondary: #666666;
            --border: #e0e0e0;
            --card-bg: #000000;
            --card-text: #ffffff;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* ============================================ */
        /* HUB PAGE */
        /* ============================================ */
        #hub {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .hub-header {
            padding: 20px 40px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        
        .hub-logo {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .hub-logo img {
            height: 36px;
            width: auto;
        }
        
        .hub-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px 20px;
            max-width: 1000px;
            margin: 0 auto;
            width: 100%;
        }
        
        .hub-hero {
            display: flex;
            align-items: center;
            gap: 60px;
            margin-bottom: 80px;
            width: 100%;
        }
        
        .hero-visual {
            flex: 1;
            background: var(--card-bg);
            border-radius: 24px;
            padding: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 300px;
        }
        
        .hero-image {
            max-width: 80%;
            max-height: 200px;
            object-fit: contain;
        }
        
        .hero-content {
            flex: 1;
        }
        
        .hero-title {
            font-size: 48px;
            font-weight: 700;
            line-height: 1.1;
            margin-bottom: 20px;
        }
        
        .hero-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .btn-primary {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: var(--bg);
            color: var(--text);
            border: 2px solid var(--text);
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .btn-primary:hover {
            background: var(--text);
            color: var(--bg);
        }
        
        .btn-primary .arrow {
            font-size: 18px;
            transition: transform 0.2s;
        }
        
        .btn-primary:hover .arrow {
            transform: translate(4px, -4px);
        }
        
        /* Features */
        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 100%;
            margin-bottom: 80px;
        }
        
        .feature-card {
            background: var(--card-bg);
            color: var(--card-text);
            border-radius: 16px;
            padding: 30px;
            min-height: 160px;
        }
        
        .feature-icon {
            font-size: 28px;
            margin-bottom: 20px;
            filter: grayscale(1) brightness(2);
        }
        
        .feature-title {
            font-size: 15px;
            font-weight: 500;
            line-height: 1.5;
        }
        
        /* Instructions */
        .instructions-section {
            width: 100%;
            margin-bottom: 60px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .section-title {
            font-size: 36px;
            font-weight: 700;
        }
        
        .tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .tag {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 400;
        }
        
        .instructions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }
        
        .instruction-card {
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
        }
        
        .instruction-step {
            width: 40px;
            height: 40px;
            background: var(--text);
            color: var(--bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin: 0 auto 20px;
        }
        
        .instruction-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .instruction-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        
        /* Footer */
        .hub-footer {
            background: var(--card-bg);
            color: var(--card-text);
            padding: 30px 40px;
            border-radius: 24px 24px 0 0;
            margin: 0 20px;
        }
        
        .footer-content {
            max-width: 1000px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .footer-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .footer-brand {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .footer-brand-name {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .footer-brand-sub {
            font-size: 12px;
            color: rgba(255,255,255,0.5);
        }
        
        .footer-contact {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .footer-contact a {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .footer-contact a:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .footer-contact a svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }
        
        .footer-divider {
            height: 1px;
            background: rgba(255,255,255,0.1);
        }
        
        .footer-bottom {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: rgba(255,255,255,0.4);
        }
        
        .footer-copy {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        /* ============================================ */
        /* MOBILE RESPONSIVE */
        /* ============================================ */
        @media (max-width: 768px) {
            .hub-header {
                padding: 15px 20px;
            }
            
            .hub-main {
                padding: 30px 15px;
            }
            
            .hub-hero {
                flex-direction: column;
                gap: 30px;
                margin-bottom: 40px;
            }
            
            .hero-visual {
                width: 100%;
                min-height: 200px;
                padding: 30px;
            }
            
            .hero-icon {
                font-size: 80px;
            }
            
            .hero-title {
                font-size: 32px;
                text-align: center;
            }
            
            .hero-subtitle {
                text-align: center;
                font-size: 14px;
            }
            
            .hero-content {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            
            .features {
                grid-template-columns: 1fr;
                margin-bottom: 40px;
            }
            
            .feature-card {
                min-height: auto;
                padding: 25px;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .section-title {
                font-size: 28px;
            }
            
            .instructions-grid {
                grid-template-columns: 1fr;
            }
            
            .hub-footer {
                margin: 0 10px;
                padding: 25px 20px;
            }
            
            .footer-main {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .footer-brand {
                align-items: center;
            }
            
            .footer-bottom {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .footer-copy {
                flex-direction: column;
                gap: 5px;
            }
        }
        
        /* ============================================ */
        /* GAME SCREEN */
        /* ============================================ */
        #game-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
        }
        
        #game-screen.active {
            display: block;
        }
        
        /* Loading */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s;
        }
        
        #loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid #333;
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #fff;
            margin-top: 20px;
            font-size: 14px;
        }
        
        /* Game background */
        #background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: linear-gradient(135deg, #0c0c1e 0%, #1a0a2e 30%, #0a1628 60%, #0f0a20 100%);
        }
        
        .bg-stars {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, #fff, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent);
            background-size: 200px 150px;
            opacity: 0.8;
        }
        
        /* Camera PIP */
        #camera-pip {
            position: fixed;
            bottom: 15px;
            left: 15px;
            width: 160px;
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid rgba(255,255,255,0.3);
            z-index: 10;
            transition: opacity 0.3s;
        }
        
        #camera-pip.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        #webcam {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
        }
        
        #tracking-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1);
        }
        
        /* Game canvas */
        #game-canvas, #laser-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        #game-canvas { z-index: 2; }
        #laser-canvas { z-index: 4; }
        
        /* Game HUD */
        #game-hud {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
        }
        
        .game-score {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            gap: 10px;
        }
        
        .score-item {
            background: rgba(0,0,0,0.7);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 10px 18px;
            text-align: center;
        }
        
        .score-label {
            font-size: 10px;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .score-value {
            font-size: 22px;
            font-weight: 700;
            color: #fff;
        }
        
        .score-item.combo .score-value {
            color: #00ffcc;
        }
        
        /* Settings button */
        .settings-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 44px;
            height: 44px;
            background: rgba(0,0,0,0.7);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.2s;
        }
        
        .settings-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .settings-btn svg {
            width: 22px;
            height: 22px;
            fill: #fff;
        }
        
        /* Settings modal */
        .settings-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            pointer-events: auto;
        }
        
        .settings-modal.active {
            display: flex;
        }
        
        .settings-panel {
            background: #fff;
            color: #000;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 320px;
        }
        
        .settings-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .setting-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .setting-row:last-of-type {
            border-bottom: none;
        }
        
        .setting-label {
            font-size: 15px;
        }
        
        /* Toggle switch */
        .toggle {
            width: 50px;
            height: 28px;
            background: #ddd;
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .toggle.active {
            background: #000;
        }
        
        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: #fff;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle.active::after {
            transform: translateX(22px);
        }
        
        .sensitivity-row {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
        }
        
        .sensitivity-control {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider {
            flex: 1;
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #000;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #000;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        .sensitivity-value {
            font-size: 14px;
            font-weight: 500;
            min-width: 40px;
            text-align: right;
        }
        
        .settings-actions {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .btn-settings {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-close-settings {
            background: #000;
            color: #fff;
        }
        
        .btn-exit-game {
            background: #fff;
            color: #000;
            border: 1px solid #ddd;
        }
        
        .btn-exit-game:hover {
            background: #f5f5f5;
        }
        
        /* Gesture indicator */
        .gesture-indicator {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            padding: 10px 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .gesture-icon { font-size: 24px; }
        .gesture-text { font-size: 13px; color: #fff; font-weight: 500; }
        
        /* Speed meter */
        .speed-meter {
            position: fixed;
            bottom: 70px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            display: none;
        }
        
        .speed-meter.visible { display: block; }
        
        .speed-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00ffcc, #ff3366);
            border-radius: 3px;
            transition: width 0.05s;
        }
        
        .speed-threshold {
            position: absolute;
            left: 80%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255,255,255,0.5);
        }
        
        /* VFX */
        .vfx-text {
            position: fixed;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 36px;
            pointer-events: none;
            z-index: 100;
            animation: vfxFloat 0.7s ease-out forwards;
        }
        
        .vfx-hit { color: #00ffcc; text-shadow: 0 0 20px #00ffcc; }
        .vfx-miss { color: #ff3366; text-shadow: 0 0 20px #ff3366; }
        
        @keyframes vfxFloat {
            0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -100%) scale(1.1); }
            100% { opacity: 0; transform: translate(-50%, -150%) scale(1); }
        }
        
        /* Crosshair */
        .crosshair {
            position: fixed;
            width: 60px;
            height: 60px;
            pointer-events: none;
            z-index: 50;
            transform: translate(-50%, -50%);
        }
        
        .crosshair-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid #fff;
            border-radius: 50%;
        }
        
        .crosshair-ring.locked { border-color: #00ffcc; }
        
        .crosshair-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            background: #fff;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .crosshair-dot.locked { background: #00ffcc; }
        
        /* Jerk flash */
        .jerk-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
            pointer-events: none;
            z-index: 99;
            opacity: 0;
        }
        
        .jerk-flash.active { opacity: 1; }
        
        /* Shoot hint */
        .shoot-hint {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.7);
            font-size: 12px;
            display: none;
        }
        
        .shoot-hint.visible { display: block; }
        
        /* Mobile game adjustments */
        @media (max-width: 768px) {
            #camera-pip {
                width: 120px;
                height: 90px;
                bottom: 10px;
                left: 10px;
            }
            
            .game-score {
                top: 10px;
                left: 10px;
            }
            
            .score-item {
                padding: 8px 12px;
            }
            
            .score-value {
                font-size: 18px;
            }
            
            .settings-btn {
                top: 10px;
                right: 10px;
            }
            
            .gesture-indicator {
                bottom: 10px;
                padding: 8px 18px;
            }
            
            .vfx-text {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- ============================================ -->
    <!-- HUB PAGE -->
    <!-- ============================================ -->
    <div id="hub">
        <header class="hub-header">
            <div class="hub-logo">
                <img src="logo.png" alt="Logo">
            </div>
        </header>
        
        <main class="hub-main">
            <section class="hub-hero">
                <div class="hero-visual">
                    <img src="hero.png" alt="Hero" class="hero-image">
                </div>
                <div class="hero-content">
                    <h1 class="hero-title">–°—Ç—Ä–µ–ª—è–π<br>–∂–µ—Å—Ç–∞–º–∏</h1>
                    <p class="hero-subtitle">–£–ø—Ä–∞–≤–ª—è–π –∏–≥—Ä–æ–π —Å –ø–æ–º–æ—â—å—é –∂–µ—Å—Ç–æ–≤ —Ä—É–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π –∫–∞–º–µ—Ä—É –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –¥–≤–∏–∂–µ–Ω–∏–π –∏ —É–Ω–∏—á—Ç–æ–∂–∞–π –º–∏—à–µ–Ω–∏.</p>
                    <button class="btn-primary" id="start-game-btn">
                        <span>–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</span>
                        <span class="arrow">‚Üó</span>
                    </button>
                </div>
            </section>
            
            <section class="features">
                <div class="feature-card">
                    <div class="feature-icon">üëÜ</div>
                    <div class="feature-title">–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∂–µ—Å—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <div class="feature-title">–ú–∞–≥–Ω–∏—Ç–Ω—ã–π –ø—Ä–∏—Ü–µ–ª —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –Ω–∞–≤–µ–¥–µ–Ω–∏–µ–º</div>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ú®</div>
                    <div class="feature-title">–ö—Ä–∞—Å–∏–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏ —Ñ–∏–∑–∏–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π</div>
                </div>
            </section>
            
            <section class="instructions-section">
                <div class="section-header">
                    <h2 class="section-title">–ö–∞–∫ –∏–≥—Ä–∞—Ç—å?</h2>
                    <div class="tags">
                        <span class="tag">–ù—É–∂–Ω–∞ –∫–∞–º–µ—Ä–∞ üì∑</span>
                        <span class="tag">–•–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ üí°</span>
                    </div>
                </div>
                
                <div class="instructions-grid">
                    <div class="instruction-card">
                        <div class="instruction-step">1</div>
                        <div class="instruction-icon">üëÜ</div>
                        <p class="instruction-text">–°–¥–µ–ª–∞–π –∂–µ—Å—Ç "–ø–∏—Å—Ç–æ–ª–µ—Ç" ‚Äî –≤—ã—Ç—è–Ω–∏ —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞–ª–µ—Ü, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å–æ–≥–Ω–∏</p>
                    </div>
                    <div class="instruction-card">
                        <div class="instruction-step">2</div>
                        <div class="instruction-icon">üéØ</div>
                        <p class="instruction-text">–î–≤–∏–≥–∞–π —Ä—É–∫–æ–π —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∏—Ü–µ–ª–æ–º –Ω–∞ —ç–∫—Ä–∞–Ω–µ</p>
                    </div>
                    <div class="instruction-card">
                        <div class="instruction-step">3</div>
                        <div class="instruction-icon">üí•</div>
                        <p class="instruction-text">–†–µ–∑–∫–æ –æ—Ç–¥—ë—Ä–Ω–∏ —Ä—É–∫—É –Ω–∞–∑–∞–¥ –∏ –≤–≤–µ—Ä—Ö ‚Äî –∫–∞–∫ –æ—Ç–¥–∞—á–∞ –æ—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞!</p>
                    </div>
                </div>
            </section>
        </main>
        
        <footer class="hub-footer">
            <div class="footer-content">
                <div class="footer-main">
                    <div class="footer-brand">
                        <span class="footer-brand-name">vahagn & co</span>
                        <span class="footer-brand-sub">Interactive Experiences</span>
                    </div>
                    <div class="footer-contact">
                        <a href="https://t.me/Mr_Aregak" target="_blank">
                            <svg viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                            <span>@Mr_Aregak</span>
                        </a>
                    </div>
                </div>
                <div class="footer-divider"></div>
                <div class="footer-bottom">
                    <div class="footer-copy">
                        <span>¬© 2025-2026 vahagn & co</span>
                        <span>–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</span>
                    </div>
                    <span>AR Gesture Shooter v1.0</span>
                </div>
            </div>
        </footer>
    </div>
    
    <!-- ============================================ -->
    <!-- GAME SCREEN -->
    <!-- ============================================ -->
    <div id="game-screen">
        <div id="loading-overlay">
            <div class="loader"></div>
            <div class="loading-text" id="loading-status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
        
        <div id="background">
            <div class="bg-stars"></div>
        </div>
        
        <div id="camera-pip">
            <video id="webcam" autoplay playsinline></video>
            <canvas id="tracking-canvas"></canvas>
        </div>
        
        <canvas id="game-canvas"></canvas>
        <canvas id="laser-canvas"></canvas>
        
        <div class="jerk-flash" id="jerk-flash"></div>
        
        <div class="speed-meter" id="speed-meter">
            <div class="speed-bar" id="speed-bar"></div>
            <div class="speed-threshold"></div>
        </div>
        
        <div class="shoot-hint" id="shoot-hint">‚Üó –û—Ç–¥—ë—Ä–Ω–∏ –Ω–∞–∑–∞–¥ + –≤–≤–µ—Ä—Ö</div>
        
        <div id="game-hud">
            <div class="game-score">
                <div class="score-item">
                    <div class="score-label">–û—á–∫–∏</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-item combo">
                    <div class="score-label">–ö–æ–º–±–æ</div>
                    <div class="score-value" id="combo">x1</div>
                </div>
            </div>
            
            <button class="settings-btn" id="settings-btn">
                <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58a.49.49 0 0 0 .12-.61l-1.92-3.32a.49.49 0 0 0-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54a.484.484 0 0 0-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58a.49.49 0 0 0-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
            </button>
            
            <div class="gesture-indicator" id="gesture-indicator" style="display: flex;">
                <span class="gesture-icon" id="gesture-icon">‚úã</span>
                <span class="gesture-text" id="gesture-text">–ü–æ–∫–∞–∂–∏ —Ä—É–∫—É</span>
            </div>
        </div>
        
        <div class="crosshair" id="crosshair" style="display: none;">
            <div class="crosshair-ring" id="crosshair-ring"></div>
            <div class="crosshair-dot" id="crosshair-dot"></div>
        </div>
        
        <!-- Settings Modal -->
        <div class="settings-modal" id="settings-modal">
            <div class="settings-panel">
                <div class="settings-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
                
                <div class="setting-row">
                    <span class="setting-label">–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–º–µ—Ä—É</span>
                    <div class="toggle active" id="toggle-camera"></div>
                </div>
                
                <div class="setting-row">
                    <span class="setting-label">–ó–≤—É–∫</span>
                    <div class="toggle active" id="toggle-sound"></div>
                </div>
                
                <div class="setting-row">
                    <span class="setting-label">–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã</span>
                    <div class="toggle active" id="toggle-indicators"></div>
                </div>
                
                <div class="setting-row sensitivity-row">
                    <span class="setting-label">–ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</span>
                    <div class="sensitivity-control">
                        <input type="range" id="sensitivity-slider" min="20" max="60" value="35" class="slider">
                        <span class="sensitivity-value" id="sensitivity-value">35%</span>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button class="btn-settings btn-close-settings" id="close-settings">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                    <button class="btn-settings btn-exit-game" id="exit-game">–í—ã–π—Ç–∏ –≤ –º–µ–Ω—é</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/three@0.150.1/build/three.min.js"></script>
    <script src="https://unpkg.com/@mediapipe/hands@0.4.1646424915/hands.js"></script>
    <script src="https://unpkg.com/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js"></script>

    <script>
        // ============================================
        // SETTINGS
        // ============================================
        const settings = {
            showCamera: true,
            soundEnabled: true,
            showIndicators: true,
            sensitivity: 0.35,  // 0.2 (–ø–ª–∞–≤–Ω–æ) - 0.6 (—Ä–µ–∑–∫–æ)
        };
        
        // ============================================
        // CONFIG
        // ============================================
        const CONFIG = {
            DISC_COUNT: 6,
            DISC_SPEED: 0.012,
            DISC_SIZE: 0.5,
            AIM_ASSIST_RADIUS: 150,
            AIM_ASSIST_STRENGTH: 0.5,
            DETECTION_INTERVAL: 20,
            SHOOT_COOLDOWN: 350,
            HIT_RADIUS: 100,
            SMOOTHING: 0.35,              // –ë–æ–ª—å—à–µ –ø–ª–∞–≤–Ω–æ—Å—Ç–∏ (–±—ã–ª–æ 0.5)
            JERK_SPEED_THRESHOLD: 0.35,    // –£–≤–µ–ª–∏—á–µ–Ω –ø–æ—Ä–æ–≥ —Å–∫–æ—Ä–æ—Å—Ç–∏
            BACK_THRESHOLD: 0.12,          // –£–≤–µ–ª–∏—á–µ–Ω –ø–æ—Ä–æ–≥ "–Ω–∞–∑–∞–¥"
            UP_THRESHOLD: 0.12,            // –£–≤–µ–ª–∏—á–µ–Ω –ø–æ—Ä–æ–≥ "–≤–≤–µ—Ä—Ö"
            HORIZONTAL_MAX: 0.25,          // –ú–∞–∫—Å–∏–º—É–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è
            JERK_COOLDOWN: 450,            // –£–≤–µ–ª–∏—á–µ–Ω –∫—É–ª–¥–∞—É–Ω
        };

        // ============================================
        // HUB NAVIGATION
        // ============================================
        const hub = document.getElementById('hub');
        const gameScreen = document.getElementById('game-screen');
        const startGameBtn = document.getElementById('start-game-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const settingsModal = document.getElementById('settings-modal');
        const closeSettingsBtn = document.getElementById('close-settings');
        const exitGameBtn = document.getElementById('exit-game');
        const toggleCamera = document.getElementById('toggle-camera');
        const toggleSound = document.getElementById('toggle-sound');
        const toggleIndicators = document.getElementById('toggle-indicators');
        const sensitivitySlider = document.getElementById('sensitivity-slider');
        const sensitivityValue = document.getElementById('sensitivity-value');
        const cameraPip = document.getElementById('camera-pip');

        startGameBtn.addEventListener('click', () => {
            hub.style.display = 'none';
            gameScreen.classList.add('active');
            initGame();
        });

        settingsBtn.addEventListener('click', () => {
            settingsModal.classList.add('active');
        });

        closeSettingsBtn.addEventListener('click', () => {
            settingsModal.classList.remove('active');
        });

        exitGameBtn.addEventListener('click', () => {
            settingsModal.classList.remove('active');
            gameScreen.classList.remove('active');
            hub.style.display = 'flex';
            // Stop game
            if (webcam.srcObject) {
                webcam.srcObject.getTracks().forEach(track => track.stop());
            }
        });

        toggleCamera.addEventListener('click', () => {
            settings.showCamera = !settings.showCamera;
            toggleCamera.classList.toggle('active', settings.showCamera);
            cameraPip.classList.toggle('hidden', !settings.showCamera);
        });

        toggleSound.addEventListener('click', () => {
            settings.soundEnabled = !settings.soundEnabled;
            toggleSound.classList.toggle('active', settings.soundEnabled);
        });

        toggleIndicators.addEventListener('click', () => {
            settings.showIndicators = !settings.showIndicators;
            toggleIndicators.classList.toggle('active', settings.showIndicators);
            gestureIndicator.style.display = settings.showIndicators ? 'flex' : 'none';
            shootHint.style.display = settings.showIndicators ? '' : 'none';
            speedMeter.style.display = settings.showIndicators ? '' : 'none';
        });

        sensitivitySlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            settings.sensitivity = val / 100;
            sensitivityValue.textContent = val + '%';
        });

        // ============================================
        // RECOIL DETECTOR
        // ============================================
        class JerkDetector {
            constructor() {
                this.history = [];
                this.maxHistory = 10;
                this.lastJerkTime = 0;
            }

            addPosition(x, y) {
                const now = Date.now();
                this.history.push({ x, y, time: now });
                if (this.history.length > this.maxHistory) {
                    this.history.shift();
                }
            }

            getMovement() {
                if (this.history.length < 4) return { dx: 0, dy: 0, speed: 0 };
                const len = this.history.length;
                const p1 = this.history[len - 4];
                const p2 = this.history[len - 1];
                const dt = (p2.time - p1.time) / 1000;
                if (dt <= 0) return { dx: 0, dy: 0, speed: 0 };
                const dx = (p2.x - p1.x) / dt;
                const dy = (p2.y - p1.y) / dt;
                return { dx, dy, speed: Math.sqrt(dx * dx + dy * dy) };
            }

            getCurrentSpeed() {
                return this.getMovement().speed;
            }

            checkJerk() {
                const now = Date.now();
                if (now - this.lastJerkTime < CONFIG.JERK_COOLDOWN) {
                    return { detected: false, speed: 0, backSpeed: 0, upSpeed: 0 };
                }

                const mov = this.getMovement();
                const backSpeed = mov.dx;      // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π = –Ω–∞–∑–∞–¥
                const upSpeed = -mov.dy;       // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π = –≤–≤–µ—Ä—Ö
                const horizontalSpeed = Math.abs(mov.dx); // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
                
                const isMovingBack = backSpeed > CONFIG.BACK_THRESHOLD;
                const isMovingUp = upSpeed > CONFIG.UP_THRESHOLD;
                const isFastEnough = mov.speed > CONFIG.JERK_SPEED_THRESHOLD;
                
                // –û—Ç–∫–ª–æ–Ω–∏—Ç—å –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –±–µ–∑ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ
                const isHorizontalOnly = horizontalSpeed > CONFIG.HORIZONTAL_MAX && upSpeed < CONFIG.UP_THRESHOLD * 0.5;
                
                // –†—ã–≤–æ–∫ = –±—ã—Å—Ç—Ä–æ + –Ω–∞–∑–∞–¥ + –≤–≤–µ—Ä—Ö + –Ω–µ —á–∏—Å—Ç–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
                const isRecoil = isFastEnough && isMovingBack && isMovingUp && !isHorizontalOnly;

                if (isRecoil) {
                    this.lastJerkTime = now;
                    return { detected: true, speed: mov.speed, backSpeed, upSpeed };
                }
                return { detected: false, speed: mov.speed, backSpeed, upSpeed };
            }

            clear() {
                this.history = [];
            }
        }

        // ============================================
        // AUDIO
        // ============================================
        class AudioSystem {
            constructor() { this.ctx = null; }
            init() {
                if (this.ctx) return;
                try { this.ctx = new (window.AudioContext || window.webkitAudioContext)(); } catch(e) {}
            }
            playShoot() {
                if (!this.ctx || !settings.soundEnabled) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(900, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(150, this.ctx.currentTime + 0.12);
                gain.gain.setValueAtTime(0.4, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.12);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.12);
            }
            playHit() {
                if (!this.ctx || !settings.soundEnabled) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sawtooth';
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(500, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, this.ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.5, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.2);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.2);
            }
            playMiss() {
                if (!this.ctx || !settings.soundEnabled) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.frequency.setValueAtTime(180, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(80, this.ctx.currentTime + 0.2);
                gain.gain.setValueAtTime(0.25, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.2);
                osc.start();
                osc.stop(this.ctx.currentTime + 0.2);
            }
        }

        // ============================================
        // GAME STATE
        // ============================================
        const gameState = {
            score: 0,
            combo: 1,
            lastHitTime: 0,
            lastShotTime: 0,
            aimPosition: { x: window.innerWidth / 2, y: window.innerHeight / 2 },
            smoothedAimPosition: { x: window.innerWidth / 2, y: window.innerHeight / 2 },
            isPistolGesture: false,
            handVisible: false,
            lockedTarget: null,
            lastHandTime: 0,
            currentLandmarks: null,
        };

        const jerkDetector = new JerkDetector();
        const audio = new AudioSystem();
        let particles, discs = [];
        let scene, camera, renderer, laserCtx;
        let hands = null;
        let gameInitialized = false;

        // DOM
        const loadingOverlay = document.getElementById('loading-overlay');
        const loadingStatus = document.getElementById('loading-status');
        const webcam = document.getElementById('webcam');
        const trackingCanvas = document.getElementById('tracking-canvas');
        let trackingCtx;
        const gameCanvas = document.getElementById('game-canvas');
        const laserCanvas = document.getElementById('laser-canvas');
        const crosshair = document.getElementById('crosshair');
        const crosshairRing = document.getElementById('crosshair-ring');
        const crosshairDot = document.getElementById('crosshair-dot');
        const scoreDisplay = document.getElementById('score');
        const comboDisplay = document.getElementById('combo');
        const gestureIndicator = document.getElementById('gesture-indicator');
        const gestureIcon = document.getElementById('gesture-icon');
        const gestureText = document.getElementById('gesture-text');
        const shootHint = document.getElementById('shoot-hint');
        const speedMeter = document.getElementById('speed-meter');
        const speedBar = document.getElementById('speed-bar');
        const jerkFlash = document.getElementById('jerk-flash');

        // ============================================
        // HAND TRACKING
        // ============================================
        const HAND_CONNECTIONS = [
            [0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],
            [0,9],[9,10],[10,11],[11,12],[0,13],[13,14],[14,15],[15,16],
            [0,17],[17,18],[18,19],[19,20],[5,9],[9,13],[13,17]
        ];

        function drawHandTracking(landmarks) {
            if (!trackingCtx) return;
            trackingCtx.clearRect(0, 0, trackingCanvas.width, trackingCanvas.height);
            if (!landmarks || landmarks.length === 0) return;

            const hand = landmarks[0];
            const w = trackingCanvas.width;
            const h = trackingCanvas.height;

            trackingCtx.strokeStyle = 'rgba(255,255,255,0.6)';
            trackingCtx.lineWidth = 1;
            for (const [start, end] of HAND_CONNECTIONS) {
                trackingCtx.beginPath();
                trackingCtx.moveTo(hand[start].x * w, hand[start].y * h);
                trackingCtx.lineTo(hand[end].x * w, hand[end].y * h);
                trackingCtx.stroke();
            }

            for (let i = 0; i < hand.length; i++) {
                const x = hand[i].x * w;
                const y = hand[i].y * h;
                trackingCtx.beginPath();
                trackingCtx.arc(x, y, i === 8 ? 6 : 3, 0, Math.PI * 2);
                trackingCtx.fillStyle = i === 8 ? '#ff3366' : 'rgba(255,255,255,0.8)';
                trackingCtx.fill();
            }
        }

        // ============================================
        // DISC
        // ============================================
        class Disc {
            constructor(index) {
                this.index = index;
                this.radius = CONFIG.DISC_SIZE;
                this.velocity = new THREE.Vector3();
                this.createMesh();
                this.spawn();
            }
            
            createMesh() {
                this.hue = Math.random();
                this.group = new THREE.Group();
                
                const discGeo = new THREE.CylinderGeometry(this.radius, this.radius, 0.12, 48);
                const discMat = new THREE.MeshStandardMaterial({
                    color: new THREE.Color().setHSL(this.hue, 0.85, 0.5),
                    metalness: 0.9, roughness: 0.15,
                    emissive: new THREE.Color().setHSL(this.hue, 0.9, 0.35),
                    emissiveIntensity: 0.5,
                });
                this.disc = new THREE.Mesh(discGeo, discMat);
                this.disc.rotation.x = Math.PI / 2;
                this.group.add(this.disc);
                
                const rimGeo = new THREE.TorusGeometry(this.radius, 0.04, 16, 48);
                const rimMat = new THREE.MeshStandardMaterial({ 
                    color: new THREE.Color().setHSL(this.hue, 1, 0.7),
                    metalness: 1, roughness: 0.1,
                    emissive: new THREE.Color().setHSL(this.hue, 1, 0.5),
                    emissiveIntensity: 0.8,
                });
                this.rim = new THREE.Mesh(rimGeo, rimMat);
                this.group.add(this.rim);
                
                const coreGeo = new THREE.CircleGeometry(this.radius * 0.4, 32);
                const coreMat = new THREE.MeshBasicMaterial({
                    color: new THREE.Color().setHSL(this.hue, 1, 0.8),
                    transparent: true, opacity: 0.9, side: THREE.DoubleSide,
                });
                this.core = new THREE.Mesh(coreGeo, coreMat);
                this.core.position.z = 0.07;
                this.group.add(this.core);
                
                this.mesh = this.group;
                scene.add(this.group);
            }
            
            spawn() {
                const edge = Math.floor(Math.random() * 4);
                const spread = 5.5;
                switch(edge) {
                    case 0: this.group.position.set((Math.random()-0.5)*spread*1.8, spread, 0); break;
                    case 1: this.group.position.set((Math.random()-0.5)*spread*1.8, -spread, 0); break;
                    case 2: this.group.position.set(-spread, (Math.random()-0.5)*spread*1.8, 0); break;
                    case 3: this.group.position.set(spread, (Math.random()-0.5)*spread*1.8, 0); break;
                }
                const tx = (Math.random() - 0.5) * 2;
                const ty = (Math.random() - 0.5) * 2;
                const dir = new THREE.Vector3(tx - this.group.position.x, ty - this.group.position.y, 0).normalize();
                this.baseSpeed = CONFIG.DISC_SPEED * (0.7 + Math.random() * 0.5);
                this.velocity.copy(dir).multiplyScalar(this.baseSpeed);
                this.rotSpeed = (Math.random() - 0.5) * 0.12;
                this.wobblePhase = Math.random() * Math.PI * 2;
                this.pulsePhase = Math.random() * Math.PI * 2;
                this.alive = true;
            }
            
            update(allDiscs) {
                if (!this.alive) return;
                this.group.position.add(this.velocity);
                
                for (const other of allDiscs) {
                    if (other === this || !other.alive) continue;
                    const dx = other.group.position.x - this.group.position.x;
                    const dy = other.group.position.y - this.group.position.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const minDist = this.radius + other.radius + 0.3;
                    
                    if (dist < minDist && dist > 0.01) {
                        const overlap = minDist - dist;
                        const nx = dx / dist, ny = dy / dist;
                        this.group.position.x -= nx * overlap * 0.3;
                        this.group.position.y -= ny * overlap * 0.3;
                        other.group.position.x += nx * overlap * 0.3;
                        other.group.position.y += ny * overlap * 0.3;
                    }
                }
                
                const currentSpeed = this.velocity.length();
                if (currentSpeed > 0.001) {
                    const speedDiff = this.baseSpeed - currentSpeed;
                    this.velocity.normalize().multiplyScalar(currentSpeed + speedDiff * 0.02);
                }
                
                this.wobblePhase += 0.03;
                this.group.rotation.x = Math.sin(this.wobblePhase) * 0.15;
                this.disc.rotation.z += this.rotSpeed;
                this.pulsePhase += 0.05;
                this.core.material.opacity = 0.7 + Math.sin(this.pulsePhase) * 0.3;
                
                if (Math.abs(this.group.position.x) > 7 || Math.abs(this.group.position.y) > 7) {
                    this.spawn();
                }
            }
            
            getScreenPos() {
                const v = this.group.position.clone();
                v.project(camera);
                return { x: (v.x * 0.5 + 0.5) * window.innerWidth, y: (-v.y * 0.5 + 0.5) * window.innerHeight };
            }
            
            respawn() {
                this.hue = Math.random();
                this.disc.material.color.setHSL(this.hue, 0.85, 0.5);
                this.disc.material.emissive.setHSL(this.hue, 0.9, 0.35);
                this.rim.material.color.setHSL(this.hue, 1, 0.7);
                this.rim.material.emissive.setHSL(this.hue, 1, 0.5);
                this.core.material.color.setHSL(this.hue, 1, 0.8);
                this.spawn();
            }
        }

        // ============================================
        // PARTICLES
        // ============================================
        class ParticleSystem {
            constructor() { this.particles = []; }
            emit(x, y, z, count = 25, hue = null) {
                for (let i = 0; i < count; i++) {
                    const size = 0.03 + Math.random() * 0.03;
                    const geo = new THREE.SphereGeometry(size, 6, 6);
                    const pHue = hue !== null ? hue : Math.random();
                    const mat = new THREE.MeshBasicMaterial({ 
                        color: new THREE.Color().setHSL(pHue, 1, 0.5 + Math.random() * 0.3),
                        transparent: true, opacity: 1,
                    });
                    const p = new THREE.Mesh(geo, mat);
                    p.position.set(x, y, z);
                    const angle = Math.random() * Math.PI * 2;
                    const speed = 0.15 + Math.random() * 0.15;
                    p.velocity = new THREE.Vector3(Math.cos(angle) * speed, Math.sin(angle) * speed + 0.1, (Math.random() - 0.5) * 0.1);
                    p.life = 1;
                    p.decay = 0.02 + Math.random() * 0.02;
                    scene.add(p);
                    this.particles.push(p);
                }
            }
            update() {
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    const p = this.particles[i];
                    p.position.add(p.velocity);
                    p.velocity.y -= 0.008;
                    p.life -= p.decay;
                    p.material.opacity = p.life;
                    p.scale.setScalar(p.life);
                    if (p.life <= 0) {
                        scene.remove(p);
                        p.geometry.dispose();
                        p.material.dispose();
                        this.particles.splice(i, 1);
                    }
                }
            }
        }

        // ============================================
        // GAME FUNCTIONS
        // ============================================
        function detectPistolGesture(landmarks) {
            if (!landmarks || landmarks.length === 0) return false;
            const h = landmarks[0];
            const indexExtended = h[8].y < h[6].y + 0.02;
            const middleCurled = h[12].y > h[10].y - 0.08;
            const ringCurled = h[16].y > h[14].y - 0.08;
            const pinkyCurled = h[20].y > h[18].y - 0.08;
            return indexExtended && [middleCurled, ringCurled, pinkyCurled].filter(x=>x).length >= 1;
        }

        function applyAimAssist(rawX, rawY) {
            let ax = rawX, ay = rawY;
            let closest = CONFIG.AIM_ASSIST_RADIUS;
            let locked = null;
            for (const d of discs) {
                if (!d.alive) continue;
                const sp = d.getScreenPos();
                const dx = sp.x - rawX, dy = sp.y - rawY;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if (dist < closest) {
                    closest = dist;
                    locked = d;
                    const pull = CONFIG.AIM_ASSIST_STRENGTH * (1 - dist/CONFIG.AIM_ASSIST_RADIUS);
                    ax = rawX + dx*pull;
                    ay = rawY + dy*pull;
                }
            }
            gameState.lockedTarget = locked;
            return { x: ax, y: ay };
        }

        function showVFX(text, x, y, isHit) {
            const el = document.createElement('div');
            el.className = `vfx-text ${isHit ? 'vfx-hit' : 'vfx-miss'}`;
            el.textContent = text;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 700);
        }

        function shoot() {
            const now = Date.now();
            if (now - gameState.lastShotTime < CONFIG.SHOOT_COOLDOWN) return;
            gameState.lastShotTime = now;

            jerkFlash.classList.add('active');
            setTimeout(() => jerkFlash.classList.remove('active'), 100);

            audio.playShoot();

            let hit = false;
            const ax = gameState.aimPosition.x, ay = gameState.aimPosition.y;

            for (const d of discs) {
                if (!d.alive) continue;
                const sp = d.getScreenPos();
                const dist = Math.sqrt((sp.x-ax)**2 + (sp.y-ay)**2);
                if (dist < CONFIG.HIT_RADIUS) {
                    hit = true;
                    particles.emit(d.group.position.x, d.group.position.y, d.group.position.z, 30, d.hue);
                    gameState.score += 100 * gameState.combo;
                    if (now - gameState.lastHitTime < 2000) gameState.combo = Math.min(gameState.combo + 1, 10);
                    gameState.lastHitTime = now;
                    d.respawn();
                    showVFX(`+${100 * gameState.combo}`, sp.x, sp.y, true);
                    audio.playHit();
                    break;
                }
            }

            if (!hit) {
                gameState.combo = 1;
                showVFX('–ú–ò–ú–û', ax, ay, false);
                audio.playMiss();
            }

            scoreDisplay.textContent = gameState.score;
            comboDisplay.textContent = `x${gameState.combo}`;
        }

        function drawLaser() {
            laserCtx.clearRect(0, 0, laserCanvas.width, laserCanvas.height);
            if (!gameState.handVisible || !gameState.isPistolGesture) return;

            const sx = gameState.smoothedAimPosition.x, sy = gameState.smoothedAimPosition.y + 50;
            const ex = gameState.aimPosition.x, ey = gameState.aimPosition.y;

            laserCtx.strokeStyle = gameState.lockedTarget ? 'rgba(0,255,204,0.2)' : 'rgba(255,255,255,0.1)';
            laserCtx.lineWidth = 10;
            laserCtx.lineCap = 'round';
            laserCtx.beginPath();
            laserCtx.moveTo(sx, sy);
            laserCtx.lineTo(ex, ey);
            laserCtx.stroke();

            laserCtx.strokeStyle = gameState.lockedTarget ? '#00ffcc' : 'rgba(255,255,255,0.8)';
            laserCtx.lineWidth = 2;
            laserCtx.beginPath();
            laserCtx.moveTo(sx, sy);
            laserCtx.lineTo(ex, ey);
            laserCtx.stroke();
        }

        function gameLoop() {
            if (!gameScreen.classList.contains('active')) return;
            requestAnimationFrame(gameLoop);

            for (const d of discs) d.update(discs);
            particles.update();

            const smoothing = settings.sensitivity;
            gameState.smoothedAimPosition.x += (gameState.aimPosition.x - gameState.smoothedAimPosition.x) * smoothing;
            gameState.smoothedAimPosition.y += (gameState.aimPosition.y - gameState.smoothedAimPosition.y) * smoothing;

            const now = Date.now();
            const handRecent = now - gameState.lastHandTime < 400;

            if (gameState.handVisible || handRecent) {
                crosshair.style.display = 'block';
                crosshair.style.left = gameState.smoothedAimPosition.x + 'px';
                crosshair.style.top = gameState.smoothedAimPosition.y + 'px';
                crosshair.style.opacity = gameState.isPistolGesture ? '1' : '0.4';
                
                if (gameState.lockedTarget) {
                    crosshairRing.classList.add('locked');
                    crosshairDot.classList.add('locked');
                } else {
                    crosshairRing.classList.remove('locked');
                    crosshairDot.classList.remove('locked');
                }
                
                if (gameState.isPistolGesture && settings.showIndicators) {
                    shootHint.classList.add('visible');
                    speedMeter.classList.add('visible');
                    const speed = jerkDetector.getCurrentSpeed();
                    speedBar.style.width = Math.min(speed / (CONFIG.JERK_SPEED_THRESHOLD * 1.25) * 100, 100) + '%';
                } else {
                    shootHint.classList.remove('visible');
                    speedMeter.classList.remove('visible');
                }
            } else {
                crosshair.style.display = 'none';
                shootHint.classList.remove('visible');
                speedMeter.classList.remove('visible');
            }

            if (gameState.currentLandmarks && settings.showCamera) {
                drawHandTracking(gameState.currentLandmarks);
            }

            drawLaser();
            renderer.render(scene, camera);

            if (now - gameState.lastHitTime > 3000) {
                gameState.combo = 1;
                comboDisplay.textContent = 'x1';
            }
        }

        let lastDetection = 0;
        async function processFrame() {
            if (!gameScreen.classList.contains('active')) return;
            const now = Date.now();
            if (hands && now - lastDetection >= CONFIG.DETECTION_INTERVAL) {
                lastDetection = now;
                try { await hands.send({ image: webcam }); } catch(e) {}
            }
            requestAnimationFrame(processFrame);
        }

        // ============================================
        // INIT GAME
        // ============================================
        async function initGame() {
            if (gameInitialized) {
                loadingOverlay.classList.add('hidden');
                gameLoop();
                processFrame();
                return;
            }

            try {
                loadingStatus.textContent = '–ó–∞–ø—Ä–æ—Å –∫–∞–º–µ—Ä—ã...';

                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: 'user', width: { ideal: 1280 }, height: { ideal: 720 } }
                });
                webcam.srcObject = stream;
                await webcam.play();

                trackingCanvas.width = webcam.videoWidth || 640;
                trackingCanvas.height = webcam.videoHeight || 480;
                trackingCtx = trackingCanvas.getContext('2d');

                loadingStatus.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏...';

                // Three.js
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.z = 5;

                renderer = new THREE.WebGLRenderer({ canvas: gameCanvas, alpha: true, antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

                laserCtx = laserCanvas.getContext('2d');
                laserCanvas.width = window.innerWidth;
                laserCanvas.height = window.innerHeight;

                scene.add(new THREE.AmbientLight(0xffffff, 0.4));
                const mainLight = new THREE.PointLight(0xffffff, 1.2, 100);
                mainLight.position.set(0, 0, 8);
                scene.add(mainLight);

                particles = new ParticleSystem();

                // MediaPipe
                hands = new Hands({
                    locateFile: (file) => `https://unpkg.com/@mediapipe/hands@0.4.1646424915/${file}`
                });
                hands.setOptions({
                    maxNumHands: 1,
                    modelComplexity: 1,
                    minDetectionConfidence: 0.4,
                    minTrackingConfidence: 0.3
                });

                hands.onResults((results) => {
                    try {
                        if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                            gameState.handVisible = true;
                            gameState.lastHandTime = Date.now();
                            gameState.currentLandmarks = results.multiHandLandmarks;
                            gameState.isPistolGesture = detectPistolGesture(results.multiHandLandmarks);

                            const h = results.multiHandLandmarks[0];
                            const indexTip = h[8];
                            jerkDetector.addPosition(indexTip.x, indexTip.y);

                            const screenX = (1 - indexTip.x) * window.innerWidth;
                            const screenY = indexTip.y * window.innerHeight;
                            const assisted = applyAimAssist(screenX, screenY);
                            gameState.aimPosition = assisted;

                            if (gameState.isPistolGesture) {
                                const recoil = jerkDetector.checkJerk();
                                if (recoil.detected) shoot();
                            }

                            if (gameState.isPistolGesture) {
                                gestureIcon.textContent = 'üî´';
                                gestureText.textContent = '–¶–µ–ª—å—Å—è';
                            } else {
                                gestureIcon.textContent = 'üëÜ';
                                gestureText.textContent = '–ü–∏—Å—Ç–æ–ª–µ—Ç';
                            }
                        } else {
                            gameState.handVisible = false;
                            gameState.isPistolGesture = false;
                            gameState.currentLandmarks = null;
                            gestureIcon.textContent = '‚úã';
                            gestureText.textContent = '–ü–æ–∫–∞–∂–∏ —Ä—É–∫—É';
                            if (trackingCtx) trackingCtx.clearRect(0, 0, trackingCanvas.width, trackingCanvas.height);
                            jerkDetector.clear();
                        }
                    } catch(e) {}
                });

                loadingStatus.textContent = '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...';

                await new Promise(resolve => {
                    const check = async () => {
                        try { await hands.send({ image: webcam }); resolve(); }
                        catch(e) { setTimeout(check, 100); }
                    };
                    setTimeout(check, 500);
                });

                for (let i = 0; i < CONFIG.DISC_COUNT; i++) discs.push(new Disc(i));

                gameInitialized = true;
                loadingOverlay.classList.add('hidden');

                document.addEventListener('click', () => audio.init(), { once: true });
                audio.init();

                gameLoop();
                processFrame();

            } catch (e) {
                loadingStatus.textContent = `–û—à–∏–±–∫–∞: ${e.message}`;
            }
        }

        window.addEventListener('resize', () => {
            if (!camera || !renderer) return;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            laserCanvas.width = window.innerWidth;
            laserCanvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
